<button id="btn" onclick="handleXhr()">xhr</button>

<script>
  var xmlHttp = window.XMLHttpRequest;
  var oldSend = xmlHttp.prototype.send;
  var handleEvent = function (event) {
    console.log(event);
  };
  xmlHttp.prototype.send = function () {
    if (this['addEventListener']) {
      // loadstart 当程序开始加载时，loadstart 事件将被触发
      // load 请求完成
      // loadend 加载进度停止之后被触发 比如 error 之后触发
      // progress 在请求接收到数据的时候被周期性触发
      // error 请求遇到错误
      // abort 请求终止
      this.addEventListener('load', handleEvent);
      this.addEventListener('error', handleEvent);
    } else {
      var oldStateChange = this['onreadystatechange'];
      this['onreadystatechange'] = function (event) {
        if (this.readyState === 4) {
          handleEvent(event);
        }
        oldStateChange && oldStateChange.apply(this, arguments);
      };
    }
    return oldSend.apply(this, arguments);
  };
</script>

<script>
  function reqListener() {
    console.log('[addEventListener]', JSON.parse(this.response));
  }

  const handleXhr = () => {
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = () => {
      if (xhr.readyState === XMLHttpRequest.DONE) {
        console.log('[onreadystatechange]', JSON.parse(xhr.response));
      }
    };
    xhr.addEventListener('load', reqListener);
    xhr.open('GET', 'http://v3.wufazhuce.com:8000/api/channel/one/0/0');
    xhr.send();
  };
</script>
